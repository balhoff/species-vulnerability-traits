###

import requests
import bs4
import re
import itertools

ID = 22713719

def get_threatText(IUCNid):
     '''
          Scrape 

     '''
     url = "http://www.iucnredlist.org/details/classify/"+ str(IUCNid) + "/0"
     ## Grab webpage text
     webpage_text = requests.get(url,stream = True)
     ### Soup it
     stripped_text = webpage_text.text.encode('utf-8').strip()

     web_soup = bs4.BeautifulSoup(stripped_text)

     ### Grab
     parse_text = None

     for divs in web_soup.find_all("div"):
          try:
               my_tag = divs['id']
          except KeyError:
               my_tag = None
               continue
          if  my_tag == "threats":
               parse_text = divs.text.encode('utf-8').strip()

     return(parse_text)

def get_threat_codes(IUCNid):


     web_text = get_threatText(IUCNid)
     if not web_text:
          raise NameError("There are no thread codes for this species")
     IUCNregex = re.compile("[1-9.]{3,6}")
     codes = IUCNregex.findall(web_text)

     combs = itertools.combinations(codes, 2)
     tfindex = []
     for i in combs:
          if i[0] in i[1][0:4]:
               try:
                    codes.remove(i[0])
               except ValueError:
                    continue

     return codes


print get_threat_codes(ID)

